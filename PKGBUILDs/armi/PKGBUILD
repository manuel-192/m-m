#!/bin/bash

# Maintainer: manuel (see forum.endeavouros.com)

pkgname=armi
pkgdesc="Rank Arch mirrors, prefer up-to-date mirrors"
url="https://github.com/manuel-192/m-m/raw/master/PKGBUILDs/$pkgname"
pkgver=24
pkgrel=0.9

arch=('any')
license=('GPL')
depends=(
    bash
    curl
    python-location         # for finding continent info
    reflector               # for listing available Arch mirrors
)
optdepends=(
    'parallel: for parallel operations'
    'eos-bash-shared: curl exit code as string'
)
backup=()

source=(
    $url/$pkgname                         # ranks Arch mirrors
    $url/$pkgname.conf                    # config file
    $url/$pkgname.completion              # bash completion
    $url/${pkgname}-helper
    $url/${pkgname}-status
)
sha512sums=('3cbd276994744e47b4d9e5ace9b6ecc0b52e4f3898a55956b521f6f857f4dd72be0e8961aaa4aae6bf564de78f3163ae7550f590a200efc99a568c947c965737'
            '8fbff84ac5f2af1c7285c0afdd18bcde4492f671dba1f5b5d17153d6fc9e8101fb291c5f9a6937a22651639d8bc57094a11eb10338abbde5326d43f013a8ab60'
            '834c483c15c9a0f8e72aa86768ca56077a83628dd5b43ab1910c05ef99cc318ff41a4b8616a9872fe3359dc92598013a3b9c6898da121668fda7850f0781997b'
            '86f59c969db8c1b6f8b65097d97954b6c621353c7809ebe1894a87c4664ef935a122ffeb0c833972bedc8838dc9738d4f99489ca93eb08eb59c198b352475345'
            '7f1acd85c06aef6a261188a6adc4740d9f67b4e691a55e1164b55e1d714262b456b38cd4de781414cdc221b088ec5d5bbb80a43f515430d63bfe84f2cdb8cd65')

package() {
    local src
    local bin=usr/bin

    for src in "${source[@]}" ; do
        src="$(basename "$src")"
        case "$src" in
            *.conf)              install -Dm644 $src  "$pkgdir/etc/skel/$src" ;;
            *.completion)        install -Dm644 $src  "$pkgdir/usr/share/bash-completion/completions/${src%.completion}" ;;
            *)                   install -Dm755 $src  "$pkgdir/$bin/$src" ;;
        esac
    done
}
