#!/bin/bash
# Maintainer: manuel (see forum.endeavouros.com)

pkgname=hlp
pkgdesc="Similar to 'man', but gets man pages from the Arch web. Also can find other info if man page doesn't exist."
url="https://github.com/manuel-192/m-m/raw/master/PKGBUILDs/$pkgname"
pkgver=2021.10.05
pkgrel=3

arch=('any')
license=('GPL')
depends=(eos-apps-info)

source=(more-man-pages)
sha256sums=('7ab6264012a4b00c823b7cf10a7dec000c5c1641875afdda64395cf4acf3867c')

package() {
    # Modify bash completion file of 'man' for $pkgname

    cp /usr/share/bash-completion/completions/man $pkgname.completion || return 1

    local extras=extra-man-pages.txt

    bash more-man-pages $extras
    install -Dm644 $extras  $pkgdir/etc/$extras

    sed -i $pkgname.completion \
        -e "s|^# man(1) completion|# $pkgname completion|" \
        -e "s|^_man()$|_man_${pkgname}_()|" \
        -e "s|complete -F _man man apropos whatis|complete -F _man_${pkgname}_ $pkgname|" \
        -e "/^[ ]*__ltrim_colon_completions/i \    COMPREPLY+=(\$(compgen -W \"\$(cat /etc/$extras)\" -- \"\$cur\"))"

    install -Dm644 $pkgname.completion  $pkgdir/usr/share/bash-completion/completions/$pkgname

    install -d $pkgdir/usr/local/bin
    ln -s /usr/bin/eos-apps-info-helper  $pkgdir/usr/local/bin/$pkgname
}
