#!/bin/bash

# Maintainer: manuel (see forum.endeavouros.com)

pkgname=pacman-ext
pkgdesc="Pacman wrapper with certain useful extra features mainly for update."
url="https://github.com/manuel-192/m-m/raw/master/PKGBUILDs/$pkgname"
pkgver=23
pkgrel=24.4
arch=(any)
license=(GPL)
depends=(bash expac)
optdepends=(
    'eos-bash-shared: nvidia vs. kernel update check'
    'eos-update-notifier: for using checkupdatesext (one of the update checkers)'

    'emacs: editor alternative for pm-gui'
    'nano: editor alternative for pm-gui'
    'vim: editor alternative for pm-gui'
    'yad: GUI widgets for pm-gui'
    'sudo: alternative privileges manager for pm-gui'
    'polkit: alternative privileges manager for pm-gui'
)
backup=(etc/pacman-ext.conf)

source=(
    $url/pacman-ext
    $url/pacman-ext.conf
    $url/pacman-ext.completion     # bash completion
    $url/pacman-ext-checks
    $url/pacman-sudo-internal
    $url/pac                       # "combines" yay/paru, pacman, paf, and adds more
    $url/pac.completion
    $url/paf                       # TUI
    $url/paq                       # use with sudo
    $url/mirror-swap-eos
    $url/pm-gui
    $url/Build
)
sha512sums=('b07ed2af65531e99aff1e79c9e740ffae1da64fcb103e39eeb204a36596551c0362ee05f81b454b190e5c5bca0988579d1ebfe56fd9b7ba769ecfdcdae632cfc'
            '3227bc7e21d7ddbb8254e65b3657164fd74dacd294d7b88894bd44e3636dbdf80ce4649b0bd00c373de748db6d88e2712c07de9fc0a93b4666322d8f7ce725ac'
            '689d6b2ef1ed982b5210dd384b4613568fd355e3ea26bfc1ca6e93438eb4a97b4f13aa056f0c459303f4558aca76e380f7f24429d7d7b97bb7803de09eda5626'
            'c488be5554128e5c6e73afa2dfa361500d778a346e751d0ca3093c228877516fe2d3bfee17137d41c02b30afc2e1ba53a9f558f0b9b69e886d6f89be0ac925f0'
            '54d414b22c6d7cc7126fafadd82e4766a063d8f7f7482b1dde67ffe162e9cee487fd430c93bc50b282cc81d320da92c6022c8e45d6706ab40143df7a0d19525f'
            '4bf04fd070cf3597a7571f79c92ff05d329971aa8bedfecbfd8f5acf828ad3b93a8cc85cbebd42bf82e3c1b57b54593d12600a36d1c9c24a90b9e34a1b8347e2'
            '36e075274aa86deb1eb545212c33b671247c61693e32d5b2cbda406d9e005b6dc83747a266a82e775664b15eeb2af96b1ba24b2680f8425dae7c840fa930422b'
            'b4de6eb61bd37a0dea4eaf3a47e1923ceb2c14de460b80d20faf4809a911bf20814724c8ec5f68fb2295f89d40e416ffc5f187ec5812d473df3e522ebfeb1c67'
            'e191f56773a852d4d258d7d3bc013ed4bbea33407cca0f07a798562ba650e701683024e5ed1eb1afa5b6e5f01f28dee8ea307a4b52f8a16d65ccc10022322af2'
            '84d89e5eeb4982675e08cc1a1b914b8255c8335ce73add5275452c28b1c5c21545d7cb823034f9ed89aaa022db9d410ea908818a65b72ef750ac5545c5fdc8b6'
            '1dda8c16231b213aff07d268f5ee8cb4093cd01e88cadd720fba3b97790f9472d05998441f374520caa4b394cad9f1b87fe7347c9920bbfd1a3ae810d4d10647'
            '37f20cd76f51aa441d213ab95a8b5efe1c197c9a3e496e0a7dbd05a4211a073a33b1d5aa6dbf68fb70a4b4e56979902c477f8c1f91dffb35d6966feb3aca411e')

package() {
    local item src

    for src in "${source[@]}" ; do
        item="${src##*/}"
        case "$item" in
            *.completion)
                install -Dm644 "$item"   "$pkgdir/usr/share/bash-completion/completions/$(basename "$item" .completion)" ;;
            *.conf)
                install -Dm644 "$item"   "$pkgdir/etc/$item" ;;
            *)
                install -Dm755 "$item"   "$pkgdir/usr/bin/$item" ;;
        esac
    done

    _changelog_generate
}

changelog=changelog.md

_changelog_generate() {
    local version
    if declare -F pkgver ; then
        version=$(pkgver)-$pkgrel
    else
        version=${pkgver}-$pkgrel
    fi

    # Write changes in simple markdown format, then it is readable in both text and markdown.

    local all_changes="
$pkgname: latest version $version

# Changes
## 23-24.4
- added more support for changelog
- use markdown in changelog
## 23-24.3
- remove a temporary file
## 23-24.2
- tiny structural rewrite
"
    echo "$all_changes" > ../$changelog
}
