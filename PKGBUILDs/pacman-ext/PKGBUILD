#!/bin/bash

# Maintainer: manuel (see forum.endeavouros.com)

pkgname=pacman-ext
pkgdesc="Pacman wrapper with certain useful extra features mainly for update."
url="https://github.com/manuel-192/m-m/raw/master/PKGBUILDs/$pkgname"
pkgver=25.10.1
pkgrel=1
arch=(any)
license=(GPL)
depends=(bash expac
        )
optdepends=(
    'eos-bash-shared: nvidia vs. kernel update check'
    'eos-update-notifier: for using checkupdatesext (one of the update checkers)'

    'emacs: editor alternative for pm-gui'
    'nano: editor alternative for pm-gui'
    'vim: editor alternative for pm-gui'
    'yad: GUI widgets for pm-gui'
    'sudo: alternative privileges manager for pm-gui'
    'polkit: alternative privileges manager for pm-gui'
    'pandoc: for upd help'
    'mirank: for updating Arch mirrors'
)
conflicts=(hook-update-description)
backup=(etc/pacman-ext.conf etc/uc-fast.conf)

source=(
    $url/pacman-ext
    $url/pacman-ext.conf
    $url/pacman-ext.completion     # bash completion
    $url/pacman-ext-checks
    $url/pacman-sudo-internal
    $url/pacman-update-helper
    $url/pacman2
    $url/pac                       # "combines" yay/paru, pacman, paf, and adds more
    $url/pac.completion
    $url/paf                       # TUI
    $url/paccache                  # makes paccache verbose
    $url/mirror-swap-eos
    $url/pm-gui
    $url/Build
    $url/uc-fast
    $url/uc-fast.conf
    $url/inst
    $url/upd
    $url/upd-small
    $url/upd.completion
    $url/eos-pacmerge
    $url/update-system
    $url/expac-aur
    $url/expac-aur.completion
    $url/fit
    $url/hook-update-description
    $url/local-update-checker   # don't installed
    $url/gaur
    $url/aur-fetch-pkg-info
    $url/fetch-aur-stuff
    $url/fetch-aur-stuff.completion
    $url/am
    $url/am.completion
)
sha512sums=('a3bfc77751dbdb2bef6d89962429c5a3baf6dfde7ee2626fc1328828363bb1bbc86578e96f7d72bb8166e7577123d71889b2a9a4a8a641435c8b3b03b45e21e6'
            'a200a89211ec4d883b53ceecf852568b4f8f1a01c7d2a3dae4be48588b23e088ed37d9f2965a585f10fdf1efcc6af2e2fca078b1a82a92ded0c464237a2b8f81'
            '3d58c1b8f3859a0e6170751d3bc3ccf9ac579954c44693f8ed35b624c669e1ac0d131e7622cc1a6b25a6c6153a391d23443b0b9c0534afe884fb5b431d72790b'
            'd045e3fad48e2441088e99fe7984ba5b52ea6405f228c2178e8add4cc55dde97fe84bdf54f12b34dd1d7bc0125aabdd6048004d2edd65c3e115974854378bcfa'
            '54d414b22c6d7cc7126fafadd82e4766a063d8f7f7482b1dde67ffe162e9cee487fd430c93bc50b282cc81d320da92c6022c8e45d6706ab40143df7a0d19525f'
            '4e62116dc2fb021a2db03fb68d5f195fa9efd1b011060bfa698c30c16b570e946b40eea61630a4bffb1c951cd31f687e450cc7ef65d7f61046cf256e872c092a'
            '0fcae212cf16cb965589d9b591f5c0a2c12b07e1054cfb0702fc5e0eb8653978adce07de96bcbf1b23a4766d43cbb29fc3e7b6d3259d03446a3d2e6b64f0f626'
            '6324b437fcd5e80c79518ff9c1672fd061c1865e855a9579b7f616a926ca9239c7ca7e6e92b4c50d89d3978b353fcfa40ce1a4872cd4e2d1833917e7f89adc5c'
            '36e075274aa86deb1eb545212c33b671247c61693e32d5b2cbda406d9e005b6dc83747a266a82e775664b15eeb2af96b1ba24b2680f8425dae7c840fa930422b'
            'b4de6eb61bd37a0dea4eaf3a47e1923ceb2c14de460b80d20faf4809a911bf20814724c8ec5f68fb2295f89d40e416ffc5f187ec5812d473df3e522ebfeb1c67'
            '2dedd78995b9c056322b4201e529fa04f8de362c984a26ce2871a7ae0ec70d980391d61ad73ca329d229c9c0a39434da2a59ba8d2fd8c9758fc6c05d06e95c53'
            '84d89e5eeb4982675e08cc1a1b914b8255c8335ce73add5275452c28b1c5c21545d7cb823034f9ed89aaa022db9d410ea908818a65b72ef750ac5545c5fdc8b6'
            '92caa0ffc7ac26e748e814554647edb2389a26239cafab289451199615553752b60f61f6a438b1e592b898b32d603181eb685da4d394555ef39347f076c06afc'
            'f77460a33c891db6d07bbaedd62df67d4d9d48240e516fe0393f4e113bfa15abf5bc408b790743f9c570019004f254c9b1670440b450c5e9bf15a44268f1475f'
            'a542a781ae7f0b9ea5972c9ce5c61764f3159a36af20e57eb43bd1406a5b0bfa8cfd6de4ef25e53b92677d787339303838948154c663235be7fb90eef5de5fc4'
            'ebdd324a893f10a19666ec3baf9f87dd80dd9c2c96c5367a878234e79a690a9916d1ba1536a49a07c99693c0775e499bf5ec5828af7321340c2d0fbd96e137ba'
            '7470c62c486d1d88159c77d5bc3a6278270f55bd8bf0ae2b2326c44511a71175bddce9bfb41526011055c777e17acd9b858cbdbe8b9ff7163f3d154a9fc431f2'
            'fe86f55b59748b131322c3afd0eaa15481daa7384b49fed2e3bfb1140cf5d280c805839585353400877a4e714b6ab316ee0ca4a28a368aa0944b5f5218e5ac0e'
            '1304f76604bbe39dd975591839fb702463225139a06c4319ec58c72a737e5206d28c00deb6c39238b0d2a6fb021cf78ba698aeca23d1d36bb0058d654e1d886e'
            '2910e388755e63bed6935b5fb13e6b272c5f8316bd5fc2c85aebb1f95064f06096861c4167fbcf14b8da43cba19268c9918b90056f36600eb5d403d0b27cc72e'
            '7a166c5a6a1f7c7c85c7217ee188a77b1085ec15aa7e74969b1b70d12dc9dbfbd2602772795712dfc0e36aafbf8e71c115cd9de97526268fa0e8d86a2682b290'
            'd2cf54eb5cc28792119dec4feac125e1e0130130c3f7709e00e99bbefbc04585b1ae3b4a025952b2a8b7489e3aff74d4534e1951540a736fa8b0206d7d349172'
            '059a5923047164b5e0941651b9aa3e6ed0e6d32eeb308442c192ef016480924c98ed00f0e88c508022c10fef3f7a723a4eb8ee599bd489d48b69dba61edb006e'
            '0073861182839fd337a8f6a92474f0a882794311d3b40f9b609d451d1595a1223e2c3f9a5336f7e89810b98993ebf95ae3d1c3acfaad15321a00da35f4412b06'
            '97d53b212a7aa3835d09ccfe6d943c0634ee781c0e913095351d1027751afc17a85822d5a6d927d6f3422617b927e60ca8214944df7d4bae2a136cd75ac67d3c'
            '9e7aad192c46dc9cab1034f3d370f98c0b7b73239b7c8d5848c5217a5ec7945add19c92994ea93218d2e3068eb4f35741bf571de758041072ffe4acc6de3a3ec'
            '091bb7afc755e65592131a15c1447e76b69b804d95e8ca5d8897c314ba47c2b7ecf84107c06640eae155d4a41105c2a292c35a5933c33af7f5967c72a2ef4dc9'
            '536efa6a35fed0575a8b6e20948591ca543eecd835f977e449971da0545542dbfc877fc7dc5de1570b2bc951ec2f9d6081cfaee28f8e73451c641eca816eca35'
            'cb103870f1b08c2d50abdf9a119f315d22dfa3737624fae0ddf3b9a4f01932cad3184d5ee0e5b3e5238bf4887b8d24088b14f315088c31d0119081847a44ec18'
            '66f0eaa68c6114f2922b8cecf2f7f413850430f1c6820870b443d3bf616e0880f7444639afa5d30fbc3b518b2255246decc9680b7aabb7a2cba578c211ca1937'
            '45f8c3d0fc191c5a23699ee0306aaf08fb495a2db30d7d306cd4690d952729c249fd473b40b3ba3724fffc3e3dfd46f4f0b5114c7e12ca783ae89e49bca4c671'
            '7bd3e17f4927199a30e0a7eb86b20413685d6d38228ed712c4086946ae69caa32118c93e381d0d20d51d63e9bfab46fda3c6bbab388dd8872a05ebc0aafe5b67'
            '0b7fdd653952931584baebea646d7567324d2d960f15748665012ea4adedc8f59662c1298020b51c051ab2d7aeaa781d6515de764a0c2fab04eb2838601fb38a')

package() {
    local item src

    for src in "${source[@]}" ; do
        item="${src##*/}"
        case "$item" in
            *.completion)
                install -Dm644 "$item"   "$pkgdir/usr/share/bash-completion/completions/$(basename "$item" .completion)"
                ;;
            *.conf)
                install -Dm644 "$item"   "$pkgdir/etc/$item"
                ;;
            local-update-checker)
                # don't install
                ;;
            paccache)
                install -Dm755 "$item"   "$pkgdir/usr/local/bin/$item"
                ;;
            am)
                install -Dm755 "$item"   "$pkgdir/usr/local/bin/$item"
                ln -s fetch-aur-stuff    "$pkgdir/usr/share/bash-completion/completions/$item"
                ;;
            *)
                install -Dm755 "$item"   "$pkgdir/usr/bin/$item"
                ;;
        esac
    done

    #_changelog_generate
}

#changelog=changelog.md

_changelog_generate() {
    local version
    if declare -F pkgver ; then
        version=$(pkgver)-$pkgrel
    else
        version=${pkgver}-$pkgrel
    fi

    # Write changes in simple markdown format, then it is readable in both text and markdown.

    local all_changes="
$pkgname: latest version $version

# Changes
## 23-24.4
- added more support for changelog
- use markdown in changelog
## 23-24.3
- remove a temporary file
## 23-24.2
- tiny structural rewrite
"
    echo "$all_changes" > ../$changelog
}
