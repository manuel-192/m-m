#!/bin/bash

# Wrapper for pacman. Knows when to have root permissions.
# Usage: pacmanwrapper [pacman-parameters]

Main()
{
    local rooterrorstring="error: you cannot perform this operation unless you are root."
    local log=$(mktemp)
    local pacman=/usr/bin/pacman
    local retpacman

    LANG=C $pacman "$@" >& $log
    retpacman=$?

    case "$retpacman" in
        0) cat $log ;;
        1)
            if [ "$(cat $log)" = "$rooterrorstring" ] ; then
                sudo $pacman "$@"
            else
                cat $log
            fi
            ;;
        *) cat $log ; echo "Warning: pacman returned error code $retpacman." >&2 ;;
    esac
    rm -f $log
}

Main "$@"
